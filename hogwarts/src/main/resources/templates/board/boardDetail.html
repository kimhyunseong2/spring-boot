<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ìƒì„¸ í™”ë©´</title>
  <link rel="stylesheet" href="/css/write.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
</head>
<body>
<!-- í—¤ë” ì¶”ê°€ -->
<div th:replace="/fragments/header.html :: fragment-header"></div>

<!-- ë„¤ë¹„ê²Œì´ì…˜ ì¶”ê°€ -->
<div th:replace="/fragments/nav.html :: fragment-nav"></div>
<div class="d-flex justify-content-center align-items-start" style="min-width: 100em;">
  <!-- ì„¸ë¶€ ë©”ë‰´ div-->
  <div class="sub--menu">
    <div class="sub--menu--top">
      <h2>ê²Œì‹œê¸€</h2>
    </div>
    <!-- ë©”ë‰´ -->
    <div class="sub--menu--mid">
      <table class="sub--menu--table" border="1">
        <tr>
          <td><a th:href="@{/board/boardDetail(id=${board.id})}" class="selected--menu">ê²Œì‹œê¸€ ìƒì„¸</a></td>
        </tr>
      </table>
    </div>
  </div>

  <!-- ë©”ì¸ div -->
  <main>
    <h1>ê²Œì‹œê¸€ ìƒì„¸</h1>
    <div class="split--div"></div>
  <div class="container">
    <form id="frm" method="post" action="/board/toggleLike">
      <table class="board_detail">
        <tbody>
        <tr>
          <th>ê¸€ ë²ˆí˜¸</th>
          <td th:text="${board.id }"></td>
          <th>ì¡°íšŒìˆ˜</th>
          <td th:text="${board.hit }"></td>
        </tr>
        <tr>
          <th>ì‘ì„±ì</th>
          <td th:text="${board.username }"></td>
          <th>ì‘ì„±ì¼</th>
          <td th:text="${#temporals.format(board.createdDate, 'yyyy/MM/dd HH:mm')}"></td>
        </tr>
        <tr>
          <th>ì¢‹ì•„ìš”</th>
          <td colspan="3">
              <input type="hidden" name="id" th:value="${board.id}">
              <button type="submit" id="likeButton" class="like-button" >
                ğŸ‘ <span id="likeText">ì¢‹ì•„ìš”</span>
              </button>
              <span id="likeCount" class="like-count" th:text="${board.likeCount}"></span>
          </td>
        </tr>
        <tr>
          <th>ì œëª©</th>
          <td colspan="3"><input type="text" id="title" name="title" th:value="${board.title }"/></td>
        </tr>
        <tr>
          <th>ë‚´ìš©</th>
          <td colspan="3"><textarea title="ë‚´ìš©" id="content" name="content" th:text="${board.content }"></textarea>
          </td>
        </tr>
        </tbody>
      </table>
      <input type="hidden" id="id" name="id" th:value="${board.id }">
    </form>

    <div class="comment-section">
      <h3>ëŒ“ê¸€ ë‹¬ê¸°</h3>
      <form id="commentForm" method="post" action="/board/addComment">
        <input type="hidden" name="boardId" th:value="${board.id}">
        <textarea name="content" placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”..." required></textarea>
        <button type="submit">ëŒ“ê¸€ ë‹¬ê¸°</button>
      </form>

      <div th:if="${comments.size() > 0}" class="comments">
        <h3>ëŒ“ê¸€ ëª©ë¡</h3>
        <div th:each="comment : ${comments}">
          <div class="comment">
            <p><strong th:text="'ëŒ“ê¸€: ' +${comment.username}"></strong>
              <span th:text="${#temporals.format(comment.createdDate,'yyyy/MM/dd HH:mm')}"></span></p>
            <p th:text="${comment.content}"></p>
            <hr />

            <form th:action="@{/board/deleteComment}" method="post" style="display:inline;">
              <input type="hidden" name="commentId" th:value="${comment.id}" />
              <input type="hidden" name="boardId" th:value="${board.id}" />
              <button th:if="${comment.username == loggedInUsername or isAdmin}" type="submit" class="delete-comment-btn">ëŒ“ê¸€ ì‚­ì œ</button>
            </form>

            <div th:if="${#lists.size(comment.replies) > 0}" class="replies">
              <div th:each="reply : ${comment.replies}">
                <div class="reply">
                  <p><strong th:text="'ë‹µê¸€: ' + ${reply.username}"></strong>
                    <span th:text="${#temporals.format(reply.created, 'yyyy/MM/dd HH:mm')}"></span>
                  </p>
                  <p th:text="${reply.content}"></p>


                  <form th:action="@{/board/deleteReply}" method="post" style="display:inline;">
                <input type="hidden" name="replyId" th:value="${reply.id}" />
                <input type="hidden" name="boardId" th:value="${board.id}" />
                <button th:if="${reply.username == loggedInUsername or isAdmin}" type="submit" class="delete-reply-btn">ë‹µê¸€ ì‚­ì œ</button>
              </form>
            </div>
              </div>
            </div>
            <!-- ë‹µê¸€ ë‹¬ê¸° í¼ -->
            <form th:action="@{/board/addReply}" method="post">
              <input type="hidden" name="boardId" th:value="${board.id}" />
              <input type="hidden" name="commentId" th:value="${comment.id}" />
              <textarea name="content" placeholder="ë‹µê¸€ì„ ì‘ì„±í•˜ì„¸ìš”..." required></textarea>
              <button type="submit" class="submit-reply-btn">ë‹µê¸€ ë‹¬ê¸°</button>
            </form>

          </div>
        </div>
      </div>
    </div>

    <div class="button-group">
      <a href="#this" id="list" class="mbtn">ëª©ë¡ìœ¼ë¡œ</a>

      <div th:if="${board.username == loggedInUsername or isAdmin}">
        <a href="#this" id="edit" class="rbtn">ìˆ˜ì •í•˜ê¸°</a>
        <a href="#this" id="delete" class="dbtn">ì‚­ì œí•˜ê¸°</a>
      </div>

    </div>

  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function(){
      $("#list").on("click", function(){
        location.href = "/board/boardList";
      });

      $("#edit").on("click", function(){
        var frm = $("#frm")[0];
        frm.action = "/board/updateBoard";
        frm.submit();
      });

      $("#delete").on("click", function(){
        var frm = $("#frm")[0];
        frm.action = "/board/deleteBoard";
        frm.submit();
      });
    });
  </script>

  </main>
</div>
</body>
</html>